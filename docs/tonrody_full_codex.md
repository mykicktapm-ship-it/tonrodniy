# TONRODY: Full Codex (Инициализация)

Этот документ станет полным собранием:
- концепции TONRODY
- технического ядра
- архитектуры
- смарт‑контрактов
- фронтенда и UX
- backend API
- баз данных
- стека разработки
- философии PULSE, влияющей на TONRODY
- истории разработки и решений
- всех выработанных правил и механик
- всех вкладок, экранов, кнопок, состояний
- всех протоколов честности
- всех моделей данных

## I. Миссия TONRODY
TONRODY — это система доказуемой честности, где математическая случайность заменяет человеческую манипуляцию. Проект создавался как единая структура: философия, механика, код, раунды, аудит. Здесь собрана вся эволюция TONRODY, включая PULSE, архитектурные решения, технические прорывы, стилистику, стек и правила, выработанные в процессе.

## II. Общая Концепция
TONRODY — это лобби-механика, в которой пользователи занимают места, вносят ставки и участвуют в честном раунде, победитель которого определяется только хешем.

Основные принципы:
- каждый шаг участника фиксируется
- каждая ставка подтверждена TON Connect
- каждый раунд имеет криптографически вычислимый результат
- всё поведение прозрачно
- ничто не может быть подкручено

## III. Архитектура Проекта
Система состоит из четырёх слоёв:
1. **Frontend (WebApp / MiniApp)**
2. **Backend API**
3. **TON Connect + Wallet Layer**
4. **Smart Contract TONRODY**

### 3.1 Frontend
Основные элементы UI:
- вкладка Home (лобби, активные столы, статус)
- вкладка Laboratory (создание лобби, тестирование функций)
- вкладка Earn (история, реферальная система)
- модальные окна действий (внести ставку, занять место, просмотр результатов)

### 3.2 Backend
Сервис обрабатывает:
- логирование
- состояние лобби
- историю ставок
- историю раундов
- обработку ошибок
- выдачу публичных данных

### 3.3 TON Connect
Используется для:
- авторизации пользователя через кошелек
- внесения ставки
- проверки транзакций
- подтверждения личности участника

### 3.4 Smart Contract
Контракт хранит:
- lobby_id
- список участников
- список ставок
- tx_hashes
- вычисленный round_hash
- определение победителя
- распределение пула

## IV. Стек Инструментов
Полный набор технологий, применённых в проекте:
- **Frontend:** React, Chakra UI, TypeScript, Vite, Telegram WebApp SDK
- **Backend:** Node.js, Express, TypeScript
- **БД:** Supabase (PostgreSQL)
- **Blockchain:** TON, Tact/FunC
- **Wallet Layer:** TON Connect UI
- **DevOps:** GitHub, Vercel, Render, Linux

## V. Вкладки и Функционал UI
### 5.1 Home
- список доступных лобби
- статус мест: free / taken / paid
- таймеры раундов
- список участников

### 5.2 Laboratory
- кнопка "Создать лобби"
- тестирование механик ставок
- отображение round_hash

### 5.3 Earn
- реферальная ссылка
- история доходов
- аналитика

## VI. Кнопки и Поведение
- **Присоединиться**: занимает свободное место
- **Внести ставку**: открывает TON Connect
- **Покинуть**: освобождает место (если ставка не внесена)
- **Создать лобби**: генерирует lobby_id и round_wallet

## VII. Механики TONRODY
### 7.1 Жизненный цикл участника
1. Зашёл в лобби
2. Получил место
3. Внёс ставку
4. Ожидание
5. Финализация раунда
6. Выплата победителю

### 7.2 Логика ставок
- ставка действительна только если tx.from = wallet участника
- сумма должна соответствовать стоимости лобби
- если ставка не внесена — место освобождается

### 7.3 Хеши и Честность
round_hash = sha256(
  lobby_id + время + сумма + concat(tx) + seed
)

winner = round_hash % count(players)

Пользователь может сам пересчитать победителя.

## VIII. База Данных
### Таблица users
(id, username, wallet, avatar, created)

### Таблица lobbies
(id, class, stake, seats, created, round_wallet)

### Таблица seats
(lobby_id, seat_index, user_id, status)

### Таблица logs
(id, lobby_id, user_id, action, seat, tx_hash, timestamp)

## IX. Полная История Разработки (Сжатый Корпус)
TONRODY формировался в виде:
- концепции честной вероятности
- рукописных схем
- прототипов MiniApp
- JSON моделей
- архитектурных набросков
- корректировок UI
- интеграции TON Connect
- вывода смарт-контрактов в Tact

## X. PULSE → TONRODY
TONRODY является практической манифестацией концепции PULSE, где:
- действие фиксируется
- история прозрачна
- резонанс создаётся в момент раунда
- прошлое не переписывается
- каждый шаг необратим

## XI. Квалифицированные Инструменты
Проект будет использовать:
- Open Source TON SDK
- toncenter / tonapi
- Supabase Auth & Storage
- Chakra UI
- React Query / Zustand
- TypeScript strict mode
- Tact smart contracts
- Vercel Edge Network

## XII. Описание Проекта
### 12.1 Что тут происходит
Пользователи занимают места в лобби, вносят TON и участвуют в честном раунде, результат которого невозможно подделать.

### 12.2 Как это происходит
1. создаётся лобби
2. генерируется кошелёк раунда
3. участники занимают места
4. вносят ставки
5. генерируется round_hash
6. определяется победитель
7. ему отправляется весь пул

## XIV. Диаграммы Процессов (Текстовые)
### 14.1. Диаграмма Раунда
```
[Создание лобби]
      ↓
[Генерация round_wallet]
      ↓
[Пользователь присоединяется]
      ↓
[Занимает место]
      ↓
[Вносит ставку]
      ↓
[tx_hash сохраняется]
      ↓
[Все места оплачены]
      ↓
[Генерация round_hash]
      ↓
[Расчёт winner]
      ↓
[Выплата пула]
      ↓
[Запись результата]
```

### 14.2. Диаграмма Действий Участника
```
[Открывает лобби]
  ↓   
[Нажимает Присоединиться]
  ↓
[TON Connect → авторизация]
  ↓
[Получает место]
  ↓
[Нажимает Внести ставку]
  ↓
[TON Connect → транзакция]
  ↓
[Сохраняется tx_hash]
  ↓
[Ожидает результат]
```

## XV. Структура Смарт-Контракта (Tact)
### Основные разделы контракта
- хранение лобби
- список участников
- ставки участников
- хеши раунда
- функция расчёта победителя
- функция выплаты

### Пример структуры (псевдокод)
```
contract Tonrody {
  map<int, Lobby> lobbies;

  struct Lobby {
    int id;
    int stake;
    int seats;
    address round_wallet;
    cell participants;
    cell tx_hashes;
    int round_hash;
    int winner;
  }

  receive(join) { ... }
  receive(pay) { ... }
  receive(finalize) { ... }
}
```

## XVI. Уровни Безопасности TONRODY
1. **Hash‑proof:** никто не может изменить round_hash.
2. **Tx‑proof:** каждая ставка доказуема через block explorer.
3. **Immutable‑state:** контракт не может менять прошлый раунд.
4. **Wallet‑bounded:** ставка принимается только от кошелька участника.
5. **Timeout‑safety:** не внес ставку — освободил место.
6. **Zero-backdoor:** механика без админских подкруток.

## XVII. WebSocket‑Слои и Синхронизация
TONRODY обновляет:
- состояние мест
- поступление ставок
- таймеры
- результат раунда
в реальном времени через `wss://` слой.

### События WebSocket:
```
seat_update
payment_confirmed
timer_tick
round_finalized
lobby_closed
```

## XVIII. Полный UX / UI Поведения
### Состояния кнопок
- отключена, пока не занято место
- активна, когда место закреплено
- в режиме ожидания, пока транзакция висит

### Анимации
- плавное появление мест
- подсветка оплаченных мест
- вспышка результата победителя

### Модальные окна
- подтверждение ставки
- ошибка транзакции
- переподключение кошелька

## XIX. Интеграция TON-Кошельков
TON Connect поддерживает:
- Tonkeeper
- MyTonWallet
- Tonhub
- OpenMask

Все транзакции проходят через стандартный request:
```
tonconnect.sendTransaction({ validUntil, messages })
```

## XX. Историческая Линия Разработки
1. Рукописные концепты (этап 1)
2. Появление PULSE и модели честности
3. Первые лобби и слоты
4. Появление round_hash
5. Введение tx_hash логов
6. Создание round_wallet
7. Объединение фронта и TON Connect
8. Формирование контрактной логики
9. Создание Codex TONRODY

## XXI. Энергетическое Ядро: PULSE → TONRODY
TONRODY наследует принципы PULSE:
- необратимость события
- чистота хода
- резонанс результата
- соответствие действия и исхода
- полная фиксация следов

Каждый раунд — это мини‑резонанс, где человек и алгоритм создают честное поле.

## XXII. Continuum‑Уровень
TONRODY является одним из слоёв Continuum:
- Pulse: осознание
- Echo: фиксация
- Vireon: действие
- Tonrody: проявление вероятности

## XXIII. Дополнение
Полный корпус проекта теперь включает все уровни: UI, UX, архитектуру, безопасность, смарт‑контракт, историю, философию, PULSE‑связи и техническое ядро.

## XIII. Заключение
TONRODY стал системой, где объединена философия, техника и честная вероятность. Этот кодекс — полная, непротиворечивая картина всего проекта.

