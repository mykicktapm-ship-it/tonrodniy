# TONRODY: Великий Свиток

Здесь будет собран единый цельный массив всех данных TONRODY: концепты, механики, формулы, процессы, модели, структура протокола, рукописные части, логика Pulse, взаимосвязи, архитектура, смарт-контракты, лобби, ставки, хеши, принципы честности и вся системная основа.

## 1. Введение
TONRODY — это система честной вероятности, построенная как игровой протокол, финансовый механизм и среда прозрачных раундов. Проект сочетает механику ставок, псевдорандомизацию через хеши, распределение призового пула, систему лобби, историю действий пользователей и строгую связку с TON.

TONRODY работает по принципу: *"ничего не скрыто, всё доказуемо"*. Каждое действие фиксируется, каждый раунд имеет вычислимый хеш, каждое место в лобби имеет статус, каждый пользователь оставляет лог.

## 2. Структура Лобби
Лобби в TONRODY — это стол с фиксированным количеством мест (например 1/3, 1/5, 1/10). Каждое место может находиться в состоянии:
- `free` свободно
- `taken` занято пользователем
- `paid` ставка внесена

### 2.1. Данные места
```
seat {
  index: number
  status: "free" | "taken" | "paid"
  user?: {
    id: string,
    username: string,
    wallet: string,
    avatar?: string
  }
}
```

### 2.2. Создание лобби
Каждое лобби получает ID по формуле:
```
class + time + seats + stake + day
```
Например: `FLO18F15-4F11`

### 2.3. Кошелёк раунда
Каждое лобби порождает свой отдельный кошелёк:
```
RoundWallet = sha256(lobby_id + day + seed)
```
Этот кошелёк принимает **только ставки** участников лобби.

## 3. Процесс Участника
1. Заходит в лобби.
2. Нажимает "Присоединиться".
3. Получает случайное свободное место.
4. Вносит ставку через TON Connect.
5. Ждет заполнения всех мест.
6. Получает результат раунда.
7. Победителю выплачивается весь пул.

## 4. Ставка
Ставка привязывается к участнику только если:
- транзакция пришла с его кошелька
- сумма соответствует stake_amount
- время ставки не превышает лимит

Если ставка не внесена, место освобождается.

## 5. Логи
Каждое действие пользователя фиксируется:
```
log {
  user_id,
  username,
  wallet,
  action: "join" | "pay" | "leave" | "result",
  seat_number,
  timestamp,
  tx_hash?,
  status: "success" | "fail"
}
```

## 6. Механика Раунда и Хеши
Хеш раунда формируется из:
- lobby_id
- создании
- stake_amount
- tx_hash всех участников
- random_seed
```
round_hash = sha256(lobby_id + created_at + stake + concat(tx_hashes) + seed)
```

## 7. Определение Победителя
```
winner_index = round_hash % number_of_players
```
Победителю отправляется весь пул TON.

## 8. Контракт (структура)
```
ContractRecord = {
  user: { id, username, wallet },
  lobby: { id, seats_total, stake_amount, created_at },
  round: { tx_hashes[], result_hash, winner }
}
```

## 9. Архитектура TONRODY
- **Frontend (Mini App / Web App)**: UI лобби, ставки, логи, результаты.
- **Backend**: API для логов, состояний, истории.
- **TON Connect**: подтверждение транзакций.
- **Smart Contract**: хранение логики раунда, хеши, распределение пула.

## 10. Принципы Честности
- Хеш фиксируется до раунда.
- Раскрывается после.
- Пользователь может сам пересчитать победителя.
- Все транзакции прозрачны.
- Раунд необратим.

## 11. Модель Данных (БД)
### Таблица: users
```
(id, username, wallet, avatar, created_at)
```

### Таблица: lobbies
```
(id, class, stake, seats_total, created_at, round_wallet)
```

### Таблица: seats
```
(lobby_id, seat_index, user_id, status)
```

### Таблица: logs
```
(log_id, lobby_id, user_id, action, seat, tx_hash, timestamp)
```

## 12. Духовное ядро TONRODY (из Pulse)
TONRODY — это не просто механизм ставок. Это поле честности, где каждый результат подтверждается математикой. Участник вступает в раунд как в ритуал случайности, где его выбор — лишь шаг в алгоритмическое поле.

Здесь действует принцип: **"Честность = доказуемость"**.

## 13. Рукописные схемы (структурировано)
### "Зашел → занял место → внес ставку → ожидание → результат"
Это главный цикл TONRODY.

### "Айди + логин + кошелек + ставки + сумма + ХЕШ + ХЕШ + ХЕШ = Контракт"
Ты описал полную формулу записи состояния.

## 14. Итог
TONRODY — это система, которая объединяет:
- честную вероятность
- прозрачный расчёт победителя
- полную историю действий
- криптографическую проверяемость
- автономию через смарт-контракт

Это свиток ядра TONRODY. Наполнение будет продолжено.

